# GoldenCircle 서비스 기능 명세서 (Functional Specification)

본 문서는 GoldenCircle 프로젝트의 핵심 기능 요구사항을 정의합니다. 본 서비스는 DAG-RAG 기반의 전문가 챗봇과 자동화된 데이터-투-비디오(CDTV) 파이프라인을 통합하여, 사용자가 데이터로부터 통찰력을 얻고 이를 교육/홍보 콘텐츠로 자동 생성 및 배포할 수 있도록 지원합니다.

---

## 1. 사용자 등록/로그인/로그아웃/탈퇴 (User Management)

### 1-1. 회원가입 (Registration)
- **이메일 가입**: 이메일, 비밀번호, 닉네임 기본 정보를 입력을 통한 가입.
- **소셜 가입 (SSO)**:
    - **Google, Apple, Kakao** 계정 연동 지원 (OAuth 2.0).
- **약관 동의**: 서비스 이용 약관 및 개인정보 처리방침 동의 절차.

### 1-2. 로그인 (Login)
- **인증 방식**:
    - **JWT 기반**: Access Token (만료 30분) / Refresh Token (만료 14일).
    - **Rotation 적용**: Refresh Token 사용 시 새로운 Refresh Token 발급 (보안 강화).
    - **저장소**: 보안을 위해 **HttpOnly Secure Cookie**에 토큰 저장.
- **자동 로그인**: 유효한 Refresh Token이 쿠키에 존재할 경우 세션 자동 연장.

### 1-3. 로그아웃 (Logout)
- 클라이언트 쿠키 삭제 및 서버 측 Refresh Token 만료/블랙리스트 처리.

### 1-4. 회원 탈퇴 (Withdrawal)
- 사용자 데이터(프로필) 삭제.
- **데이터 보존 정책**: 법적 의무 기록을 제외한 개인 식별 정보 즉시 파기. 단, 생성된 콘텐츠(영상 등)의 소유권 및 존속 여부는 약관에 따름.

---

## 2. AI 기반 Chatbot 도우미 (AI Chatbot Assistant)

### 2-1. 전문가 페르소나 (Persona)
- **Gem**: 딥러닝 및 데이터 분석 전문가 페르소나 적용 (`system_instruction`).
- 사용자의 질문 의도를 파악하고 전문적인 톤앤매너로 응답.

### 2-2. DAG-RAG 대화 엔진
- **Context Merging**: 사용자의 다중 질문 및 이전 대화 맥락을 DAG(Directed Acyclic Graph) 구조로 관리. 답변 생성 시 관련 부모 노드의 대화 히스토리를 병합하여 전달.
- **Grounding (근거 확보)**: 답변은 반드시 내부 지식 베이스(RAG)에 근거해야 함.

### 2-3. 삼중 기억 시스템 (Triple Memory)
- **단기 기억**: 현재 세션의 대화 흐름 유지 (FastAPI/Redis).
- **장기 기억 (Vector)**: Qdrant를 활용한 비정형 문서/텍스트 의미 검색.
- **장기 기억 (Graph)**: Neo4j를 활용한 엔티티 관계 및 구조적 지식 추론.

---

## 3. 데이터 분석 및 시각화 도우미 (Data Analysis & Visualization)

### 3-1. 데이터 수집 및 전처리
- **파일 업로드**: CSV, Excel, PDF 등 분석 대상 파일 업로드.
- **자동 전처리**: 결측치 처리, 데이터 타입 변환 등의 기본적인 전처리 자동 제안 및 수행.

### 3-2. 탐색적 데이터 분석 (EDA) 지원
- **대화형 분석**: 채팅을 통해 "이 데이터의 상관관계를 보여줘", "이상치를 찾아줘" 등의 자연어 명령 수행.
- **Python 코드 생성**: Pandas/Matplotlib 등을 활용한 분석 코드를 AI가 생성하고 실행 결과를 반환.

### 3-3. 시각화 생성
- **차트 추천**: 데이터 특성에 맞는 최적의 시각화 유형(Bar, Line, Scatter, Heatmap 등) 자동 추천.
- **이미지 내보내기**: 생성된 차트를 고해상도 이미지(PNG/SVG)로 저장 및 리포트 활용.

---

## 4. 데이터 기반 교육 영상 자동 생성 도우미 (CDTV Assistant)

### 4-1. 주제 분석 및 대본 생성 (Analysis & Scripting)
- **WHY-HOW-WHAT 추출**: 업로드된 문서/대화 내용에서 Golden Circle 프레임워크에 맞춰 핵심 가치(WHY), 방법(HOW), 결과(WHAT)를 추출.
- **LLM 스크립팅**: 추출된 구조 데이터를 바탕으로 교육용 비디오 대본(Script) 자동 생성.
- **감정 분석**: 텍스트의 정서적 톤을 분석하여 AI 아바타의 표정 및 어조 설정값 생성.

### 4-2. 비디오 합성 (Synthesis) - 비동기 처리
- **엔진**: **HeyGen API**를 우선적으로 연동하여 SNS/YouTube용 숏폼 및 교육 영상 제작.
- **비동기 큐**: 영상 생성 요청 시 작업 ID를 발급하고 백그라운드에서 처리.
- **알림**: 생성 완료 시 사용자에게 알림(웹 푸시 또는 이메일) 및 결과 URL 제공.

### 4-3. HITL (Human-in-the-Loop) 검증
- **대본 검토**: 영상 생성 전, AI가 작성한 대본을 사용자가 수정/승인하는 단계 포함.

---

## 5. SNS 포스팅 자동화 도우미 (SNS Automation)

### 5-1. 채널 연동
- **1차 (MVP)**: **YouTube** (Google OAuth 2.0, `youtube.upload` 권한).
- **2차**: **LinkedIn** 프로필/페이지 업로드 연동.

### 5-2. 메타데이터 최적화
- **SEO 자동화**: 영상 내용에 기반하여 검색 엔진 최적화된 제목, 설명, 태그, 해시태그 자동 생성 (LLM 활용).

### 5-3. 자동 업로드 및 스케줄링
- **즉시 업로드**: 생성된 비디오를 연결된 채널에 즉시 게시.
- **예약 업로드**: 지정된 날짜/시간에 업로드되도록 스케줄링.
- **재시도 전략**: API 오류 시 지수 백오프(Exponential Backoff) 적용.

---

## 6. 설정 (Settings)

### 6-1. 사용자 프로필
- 닉네임, 프로필 이미지 변경.
- 알림 설정 (이메일, 푸시 알림 수신 여부).

### 6-2. 연동 계정 관리
- 연결된 소셜 계정(Google, Apple, Kakao 등) 및 SNS 채널(YouTube)의 연동 상태 확인 및 해제.
- API 키 관리.

### 6-3. 서비스 정책
- 데이터 보존 기간 설정.
- 멤버십 구독 상태 확인 및 관리.

---

## 7. 구독 및 지불 (Subscription & Payment)

### 7-1. 요금제 등급 (Tier)
- **Free**: 기본 챗봇 사용, 월 n회 제한적 영상 생성 (워터마크).
- **Pro**: 무제한 분석, 월 n분 고화질 영상 생성 (워터마크 제거).
- **Enterprise**: 맞춤형 페르소나, 전용 API, 대용량 스토리지.

### 7-2. 결제 시스템 연동
- **PG사 연동**: **PortOne (구 아임포트)**를 통해 통합 연동.
    - **국내**: 토스페이먼츠 (Toss Payments).
    - **해외**: Stripe.
- **구독 관리**: 자동 결제, 결제 수단 변경, 영수증 발급, 구독 취소/환불.

### 7-3. 사용량 모니터링
- 토큰 사용량(AI), 비디오 생성 시간(분) 등 쿼터 사용 현황 대시보드 제공.

---

## 8. 기타 (Others)

### 8-1. 아키텍처 및 인프라
- **배포 환경**: **Google Cloud Platform (GCP)**.
- **도메인**: `www.goldencircle.us`.
- **구성**: Docker Compose 기반의 4-Tier (Nuxt, FastAPI, Qdrant, Neo4j) 아키텍처 (GCE or Cloud Run).
- **보안**: HTTPS 통신 강제, 중요 데이터(API Key) 암호화 저장, 내부 네트워크 격리.

### 8-2. 관리자(Admin) 기능
- 사용자 관리, 결제 내역 조회, 시스템 리소스 모니터링.

### 8-3. 고객 지원
- FAQ, 사용자 가이드(매뉴얼), 1:1 문의 채널.
